<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap-slider.min.css">
    <script src="./js/lib/jquery-2.1.4.js"></script>
    <script src="./js/lib/bootstrap.js"></script>
    <script src="./js/lib/bootstrap-slider.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/shannon.js"></script>
    <title>source encoding demo</title>
    <style>
        #input-slider-container div.form-group {
            margin-bottom: 36px;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row text-center">
        <h1>信源编码示例</h1>

        <h3>source encoding demo</h3>
    </div>
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
            <div class="panel panel-default">
                <div class="panel-heading">输入信源</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-5 col-xs-7">
                            <div class="form-group">
                                <p class="help-block">调整信源各分量输入概率</p>
                            </div>
                        </div>
                        <div class="col-xs-1">
                            <div class="form-group">
                                <button type="button" id="updateSlider" class="btn btn-warning">
                                    <span class="glyphicon glyphicon-refresh"></span>
                                </button>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <button type="button" id="destroySlider" class="btn btn-danger btn-block">
                                    <span class="glyphicon glyphicon-edit"></span>手动输入分量
                                </button>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <button type="button" id="addSlider" class="btn btn-default btn-block">
                                    <span class="glyphicon glyphicon-plus"></span>添加信源参数
                                </button>
                            </div>
                        </div>
                        <p></p>
                    </div>
                    <div class="col-sm-12">
                        <div class="row">
                            <form class="clearfix">
                                <div id="input-slider-container" class="form-group">
                                    <div class="form-group">
                                        <input class="form-control source-input-slider" data-slider-min="0"
                                               data-slider-max="1" data-slider-step="0.01" data-slider-value="0"
                                               type="text">
                                    </div>
                                    <div class="form-group">
                                        <input class="form-control source-input-slider" data-slider-min="0"
                                               data-slider-max="1" data-slider-step="0.01" data-slider-value="0"
                                               type="text">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-4 col-sm-offset-2">
            <div class="panel panel-default">
                <div class="panel-heading">输入参数</div>
                <div class="panel-body">
                    <div id="input-params">
                        0,0
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-4 col-sm-offset-0">
            <div class="panel panel-default">
                <div class="panel-heading">应用参数</div>
                <div class="panel-body">
                    <div id="apply-params">
                        0,0
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
            <div class="panel panel-default">
                <div class="panel-heading">编码结果</div>
                <div class="panel-body">
                    <div class="row">
                        <h3>香农编码</h3>
                        <table id="shannonTable" class="table">
                        </table>
                    </div>
                    <div class="row">
                        <h3>费诺编码</h3>
                        <table id="fenoTable" class="table">
                        </table>
                    </div>
                    <div class="row">
                        <h3>赫夫曼编码</h3>
                        <table id="huffmanTable" class="table">
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    var isDestroy = false;
    var currentInputParam = [];
    var updateSlider = function () {
        if (!isDestroy) {
            var sliders = $('.source-input-slider');
            sliders.slider({});
            sliders.on("slide", function (slideEvt) {
                updateSliderValue();
            });
        }
    };

    var updateSliderValue = function () {
        var sliders = $('.source-input-slider');
        var vals = [];
        for (var i = 0; i < sliders.length; i++) {
            var val = Number(sliders[i].value);
            if (isNaN(val)) {
                alert('请输入数字');
            } else {
                vals.push(val.toFixed(2));
            }
        }
        currentInputParam = vals;
        $('#input-params').text(vals);
        updateApplyParam();
    };

    var updateApplyParam = function () {
        var applyParam = [];

        for (var i = 0; i < currentInputParam.length; i++) {
            applyParam[i] = currentInputParam[i];
        }
        Common.sort(applyParam);//排序
        Common.clearRedundantZero(applyParam);//清除0

        $('#apply-params').text(applyParam);

        updateShannon(applyParam)
    };

    var updateShannon = function(applyParam){
        var sn = new Shannon(applyParam);
        var list = sn.Analyze();

        var field = '<tr><td>信源符号</td>';
        var data = '<tr><td>码字</td>';
        for(var i = 0;i<list.length;i++){
            field += '<td>'+list[i].sign+'</td>';
            data += '<td>'+list[i].code+'</td>';
        }
        field += '</tr>';
        data += '</tr>';

        $('#shannonTable').html(field + data);
    };

    (function () {
        updateSlider();
        $('#destroySlider').click(function () {
            $('.source-input-slider').slider('destroy');
            isDestroy = true;
            console.log('have been destory');
        });
        $('#addSlider').click(function () {
            var html = '<div class="form-group"><input class="form-control source-input-slider" data-slider-min="0" data-slider-max="1" data-slider-step="0.01" data-slider-value="0" type="text"></div>';
            var container = $('#input-slider-container');
            container.append(html);
            updateSlider();
        });
        $('#updateSlider').click(function(){
            updateSliderValue();
        });
    })();
</script>
</html>